<!doctype html>
<html lang="en-GB">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Ford Property Services ‚Ä¢ Photo Notes</title>
<meta name="theme-color" content="#0b1220">

<style>
:root{
  --bg:#0b1220; --line:rgba(255,255,255,.14);
  --text:#e7eefc; --muted:#a9b7d3;
  --good:#22c55e; --bad:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg)}
header{position:sticky;top:0;z-index:10;background:#0b1220;border-bottom:1px solid var(--line)}
.wrap{max-width:1100px;margin:0 auto;padding:14px 16px}
.top{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:54px;height:54px;border-radius:14px;background:#fff;color:#000;display:grid;place-items:center;font-weight:900}
main{max-width:1100px;margin:0 auto;padding:16px}
.card{border:1px solid var(--line);border-radius:18px;padding:14px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{
  background:rgba(255,255,255,.06);color:var(--text);
  border:1px solid var(--line);border-radius:14px;
  padding:10px 12px;font-weight:900
}
button.good{border-color:rgba(34,197,94,.5)}
button.bad{border-color:rgba(239,68,68,.5)}
input,textarea{
  width:100%;background:rgba(0,0,0,.2);color:var(--text);
  border:1px solid var(--line);border-radius:14px;padding:10px 12px
}
textarea{min-height:90px}
.grid{display:grid;gap:12px;margin-top:12px}
@media(min-width:800px){.grid{grid-template-columns:1fr 1fr}}
.item{border:1px solid var(--line);border-radius:18px;padding:12px}
.thumb{aspect-ratio:4/3;border:1px solid var(--line);border-radius:14px;overflow:hidden;margin-bottom:8px;background:#000}
.thumb img{width:100%;height:100%;object-fit:contain}
.small{font-size:12px;color:var(--muted)}
.toast{
  position:fixed;bottom:16px;left:50%;transform:translateX(-50%);
  background:#000;color:#fff;padding:10px 14px;border-radius:14px;display:none;font-weight:900
}

/* CAMERA MODAL */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;z-index:50}
.panel{background:#0b1220;border:1px solid var(--line);border-radius:18px;padding:12px;width:min(960px,95%)}
.videoWrap{aspect-ratio:16/9;background:#000;border-radius:14px;overflow:hidden}
video{width:100%;height:100%;object-fit:cover}

/* PDF PRINT */
@media print{
  header, .no-print, .modal {display:none!important}
  body{background:#fff;color:#000}
  .card,.item{border:1px solid #ccc}
  .thumb{background:#fff}
  textarea{border:none;background:none;color:#000}
}
</style>
</head>

<body>

<header>
  <div class="wrap top">
    <div class="brand">
      <div class="logo">FPS</div>
      <div>
        <strong>Ford Property Services</strong><br>
        <span class="small">Photo Notes</span>
      </div>
    </div>
    <a href="/app/dashboard/" class="no-print" style="color:#9ecbff;text-decoration:none">‚Üê Dashboard</a>
  </div>
</header>

<input id="galleryInput" type="file" accept="image/*" multiple style="display:none">

<main>
  <div class="card">

    <!-- PDF HEADER -->
    <div style="margin-bottom:10px">
      <strong>Property Address:</strong>
      <div id="pdfAddress">‚Äî</div>
      <div class="small">Date: <span id="pdfDate">‚Äî</span></div>
    </div>

    <!-- CONTROLS -->
    <div class="row no-print">
      <button id="openCamera" class="good">üì∑ Open camera</button>
      <button id="chooseGallery">üñºÔ∏è Gallery</button>
      <button onclick="window.print()">üßæ Save PDF</button>
    </div>

    <div class="row no-print" style="margin-top:12px">
      <input id="address" placeholder="Property address">
      <input id="date" type="date">
    </div>

    <textarea id="general" class="no-print" placeholder="General notes (optional)" style="margin-top:12px"></textarea>

    <div id="list" class="grid"></div>

  </div>
</main>

<!-- CAMERA -->
<div id="camModal" class="modal">
  <div class="panel">
    <div class="videoWrap"><video id="video" autoplay playsinline muted></video></div>
    <div class="row" style="margin-top:8px">
      <button id="snap" class="good">üì∏ Take photo</button>
      <button id="closeCam" class="bad">‚úï Close</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Saved</div>

<script>
const $=id=>document.getElementById(id);
const STORE="fps_photo_notes_pdf";
let state={address:"",date:"",items:[]};

function toast(t){$("toast").textContent=t;$("toast").style.display="block";setTimeout(()=>$("toast").style.display="none",1200)}
function save(){localStorage.setItem(STORE,JSON.stringify(state));syncPdf()}
function load(){
  const r=localStorage.getItem(STORE);
  if(r)state=JSON.parse(r);
  $("address").value=state.address||"";
  $("date").value=state.date||"";
  render();syncPdf();
}

function syncPdf(){
  $("pdfAddress").textContent=state.address||"‚Äî";
  $("pdfDate").textContent=state.date||"‚Äî";
}

$("address").oninput=e=>{state.address=e.target.value;save()}
$("date").onchange=e=>{state.date=e.target.value;save()}

function render(){
  const l=$("list");l.innerHTML="";
  state.items.forEach((it,i)=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <div class="thumb"><img src="${it.img}"></div>
      <textarea placeholder="Notes for this photo...">${it.note||""}</textarea>
      <div class="row no-print" style="margin-top:6px">
        <button>üé§ Dictate</button>
        <button class="bad">üóëÔ∏è Delete</button>
      </div>
    `;
    const ta=d.querySelector("textarea");
    ta.oninput=e=>{it.note=e.target.value;save()}
    const [dict,del]=d.querySelectorAll("button");

    dict.onclick=()=>startDictation(ta);
    del.onclick=()=>{state.items.splice(i,1);save();render()}
    l.appendChild(d);
  });
}

/* Dictation */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
let rec;
function startDictation(target){
  if(!SR){alert("Dictation not supported in this browser");return}
  if(rec)rec.stop();
  rec=new SR();
  rec.lang="en-GB";
  rec.interimResults=false;
  rec.onresult=e=>{
    target.value+=(target.value?" ":"")+e.results[0][0].transcript;
    target.dispatchEvent(new Event("input"));
  };
  rec.start();
}

/* Camera */
let stream;
$("openCamera").onclick=async()=>{
  $("camModal").style.display="flex";
  stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  $("video").srcObject=stream;
}
$("closeCam").onclick=()=>{stream.getTracks().forEach(t=>t.stop());$("camModal").style.display="none"}
$("snap").onclick=()=>{
  const v=$("video"),c=document.createElement("canvas");
  c.width=v.videoWidth;c.height=v.videoHeight;
  c.getContext("2d").drawImage(v,0,0);
  state.items.push({img:c.toDataURL("image/jpeg",0.94),note:""});
  save();render();toast("Photo added");
}

/* Gallery */
$("chooseGallery").onclick=()=>$("galleryInput").click();
$("galleryInput").onchange=async e=>{
  for(const f of e.target.files){
    const img=new Image();img.src=URL.createObjectURL(f);await img.decode();
    const c=document.createElement("canvas");
    c.width=img.width;c.height=img.height;
    c.getContext("2d").drawImage(img,0,0);
    state.items.push({img:c.toDataURL("image/jpeg",0.94),note:""});
  }
  save();render();
}

/* Init */
(function(){
  const d=new Date();
  $("date").value=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  load();
})();
</script>

</body>
</html>
